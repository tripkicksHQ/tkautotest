<!DOCTYPE html>
<!-- Alpha 0110am12.29.24 -->
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>tkAuto</title>
  <!-- Favicon -->
  <link rel="icon" href="https://info.tripkicks.com/hubfs/mock/auto/tkAfav.png" type="image/x-icon" />

  <!-- Latest compiled and minified CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://info.tripkicks.com/hubfs/system/mockup/tk-css.css" rel="stylesheet" type="text/css" />

  <!-- CodeMirror 5 CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <!-- Dracula Theme for CodeMirror 5 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css" />

  <style>
    :root {
      --tk-white-rgb: 255, 255, 255;
    }
    .tile {
      padding: 0;
    }
    .tile .card {
      width: 100%;
      margin: 0;
      border-radius: 0;
      border: 2px solid rgba(var(--tk-white-rgb), 1);
    }
    #tileInputs {
      margin-top: 20px;
      padding-bottom: 20px;
    }
    #banner {
      margin-top: 20px;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
    }
    #codeViewContainer {
      margin-top: 20px;
    }
    #codeView {
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 600px;
      overflow: auto;
    }
    .tile-editor-preview {
      display: flex;
      flex-direction: row;
      gap: 10px;
      margin-bottom: 20px;
    }
    .live-preview {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background-color: #ffffff;
      overflow: auto;
      min-height: 200px;
      max-width: 30%;
      flex-shrink: 0;
    }
    .code-editor {
      position: relative;
      flex-grow: 1;
    }
    .copy-code-btn {
      margin-top: 10px;
    }
    .CodeMirror {
      height: auto;
      min-height: 100px;
      max-height: 90vh;
      overflow: auto;
    }
    /* Note: We leave the original media queries as they were, 
       but the page is always viewed on desktop as per your instructions. */
    @media (max-width: 1200px) {
      .tile-editor-preview {
        flex-direction: column;
      }
      .live-preview,
      .code-editor {
        width: 100%;
      }
    }
    .fare-section {
      margin-top: 40px;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      background-color: #fdfdfd;
    }
    .fare-section h4 {
      margin-bottom: 20px;
    }
    .icon-input-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .fare-preview-card {
      max-width: 1500px;
    }
    .fare-preview-icons img {
      height: 35px;
      margin-right: 3px;
    }
    .fare-inputs .form-check {
      margin-left: 10px;
    }
    /* --- ADDED for always-square hotel image --- */
    #farePreviewImage {
      width: 100%;
      aspect-ratio: 1/1;
      object-fit: cover;
      object-position: center;
    }
  </style>
</head>
<body>
  <!-- PAGE HEADER -->
<header style="text-align: left; padding: 20px; margin-bottom: 20px; background-color: #ffc107;">
  <a href="#" style="font-size: 12px; font-weight: bold; text-decoration: none; color: #4d5466; margin: 0 15px;">tkAutoBETA</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Banner</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Fares</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Insights</a>
</header>

  <!-- BANNER SECTION -->
  <div class="container">
    <div class="d-flex align-items-center mb-3">
      <label for="bannerType" class="me-3 fs-6 fw-lighter">Select Banner Type:</label>
      <select id="bannerType" class="form-select w-auto">
        <option value="search">Search (with city image)</option>
        <option value="anytime">Anytime (without city image)</option>
      </select>
      <div id="cityInputs" class="d-flex align-items-center ms-4 d-none">
        <label for="cityName" class="me-2 fs-6 fw-lighter">City:</label>
        <input type="text" id="cityName" class="form-control me-3" placeholder="Enter city name" value="New York City" />
        <label for="cityImageUrl" class="me-2 fs-6 fw-lighter">URL:</label>
        <input type="text" id="cityImageUrl" class="form-control" placeholder="Enter image URL" value="https://info.tripkicks.com/hubfs/ClientInsights/tkDemo/cityimage_NYC.png" />
      </div>
    </div>

    <div class="tk_css" id="pageBanner">
      <div class="row">
        <div class="col-12 mb-2">
          <div class="card border border-primary z-0" style="border-radius: 10px 10px 0 10px; z-index: 1;">
            <div class="card-body p-0">
              <div class="row g-0" id="bannerContent">
                <!-- Dynamically adjusted content for Search/Anytime -->
              </div>
            </div>
          </div>
          <div class="border border-primary border-top-0 z-3 bg-white ps-2" 
               style="float: right; width: 136px; position: relative; z-index: 1000; border-top: 5px solid white; border-bottom-left-radius: 8px; box-shadow: 0 0 0 0 rgba(16, 24, 40, 0.03); margin-top: -1px;">
            <div style="justify-content: flex-start; align-items: center; display: flex;">
              <div style="text-align: right; color: #326bf4; font-size: 8px; font-family: 'Helvetica Neue', sans-serif; font-weight: 300; line-height: 18px; white-space: nowrap;">
                powered by
              </div>
              <img style="margin-left: 5px; width: 70px;" src="https://info.tripkicks.com/hubfs/system/tkEmail150.png" alt="Tripkicks Logo" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Copy Banner & Download Banner Buttons (existing) -->
    <div class="d-flex gap-2 mt-4">
      <button id="copyBannerBtn" class="btn btn-outline-warning">Copy Banner</button>
      <button id="downloadBannerBtn" class="btn btn-warning">Download Banner PNG</button>
    </div>

    <!-- NEW: Tile & Modal Preview Section (initially collapsed) -->
    <div class="container fare-section" id="tileModalSection" style="margin-top: 40px;">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h4>Tile & Modal Preview</h4>
        <button id="toggleTileModalBtn" class="btn btn-primary btn-sm">Open Tile & Modal</button>
      </div>
      <!-- Collapsible content -->
      <div id="tileModalContent" style="display: none;">
        <div class="row">
          <!-- Left Column: Code Editors -->
          <div class="col-md-6">
            <!-- Tile HTML Editor -->
            <div class="form-group mb-3">
              <label for="tileHtmlEditor" class="fw-lighter">Tile HTML</label>
              <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                <select id="tileTemplateDropdown" class="form-select w-auto">
                  <option value="placeholder" selected>placeholder</option>
                  <option value="1tileAuto">1tileAuto</option>
                  <option value="2tileAuto">2tileAuto</option>
                  <option value="3tileAuto">3tileAuto</option>
                  <option value="4tileAuto">4tileAuto</option>
                  <option value="5tileAuto">5tileAuto</option>
                  <option value="6tileAuto">6tileAuto</option>
                  <option value="7tileAuto">7tileAuto</option>
                  <option value="bookNow">bookNow</option>
                  <option value="flexDates">flexDates</option>
                  <option value="carbonFoot">carbonFoot</option>
                  <option value="rateTarget">rateTarget</option>
                  <option value="gate4">gate4</option>
                </select>
                <button id="copyTileCodeBtn" type="button" class="btn btn-sm btn-outline-primary">Copy Code</button>
              </div>
              <textarea id="tileHtmlEditor" class="form-control" placeholder="Enter HTML for Tile"></textarea>
            </div>
            <!-- Modal HTML Editor -->
            <div class="form-group mb-3">
              <label for="modalHtmlEditor" class="fw-lighter">Modal HTML</label>
              <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                <select id="modalTemplateDropdown" class="form-select w-auto">
                  <option value="placeholder" selected>placeholder</option>
                  <option value="1modalAuto">1modalAuto</option>
                  <option value="2modalAuto">2modalAuto</option>
                  <option value="3modalAuto">3modalAuto</option>
                  <option value="4modalAuto">4modalAuto</option>
                  <option value="5modalAuto">5modalAuto</option>
                  <option value="6modalAuto">6modalAuto</option>
                  <option value="7modalAuto">7modalAuto</option>
                  <option value="8modalAuto">8modalAuto</option>
                  <option value="9modalAuto">9modalAuto</option>
                  <option value="10modalAuto">10modalAuto</option>
                </select>
                <button id="copyModalCodeBtn" type="button" class="btn btn-sm btn-outline-primary">Copy Code</button>
              </div>
              <textarea id="modalHtmlEditor" class="form-control" placeholder="Enter HTML for Modal"></textarea>
            </div>
          </div>
          <!-- Right Column: Live Previews -->
          <div class="col-md-6">
            <div id="previewContainer">
              <!-- Tile Preview (with border) -->
              <div id="tilePreview" style="border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; width: 100%;"></div>
              <!-- Modal Preview (no border; aspect ratio maintained) -->
              <div id="modalPreview" style="width: 100%; aspect-ratio: 464 / 600;"></div>
            </div>
            <div class="mt-2 d-flex gap-2">
              <button id="downloadTileModalBtn" type="button" class="btn btn-warning btn-sm">Download Preview PNG</button>
              <button id="copyTileModalPreviewBtn" type="button" class="btn btn-outline-warning btn-sm">Copy Preview</button>
            </div>
          </div>
        </div>
      </div> <!-- End tileModalContent -->
    </div>

    <!-- Existing Tile Inputs Section (if any) -->
    <div id="tileInputs"></div>

    <button id="renderTiles" class="btn btn-success btn-sm mt-3" disabled>Render Tiles</button>
    <button id="button2" class="btn btn-success btn-sm mt-3">Render Top Full-Width</button>
    <button id="button3" class="btn btn-secondary btn-sm mt-3" disabled>Button 3</button>

    <div id="codeViewContainer" class="mt-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">Rendered HTML</h5>
      </div>
      <pre id="codeView" hidden></pre>
    </div>
  </div>

  <!-- LODGING FARE SECTION -->
  <div class="container fare-section" id="lodgingFareSection">
    <h4>Lodging Auto Fare</h4>
    <div class="row">
      <!-- Left column: Icon toggles/dropdowns -->
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Choose icons and toggles for A–E:</p>
        <!-- Icon A -->
        <div class="icon-input-row">
          <select id="fareSelectA" class="form-select w-auto">
            <option value="">Default (A.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareToggleA" checked />
            <label class="form-check-label" for="fareToggleA">Show A</label>
          </div>
        </div>
        <!-- Icon B -->
        <div class="icon-input-row">
          <select id="fareSelectB" class="form-select w-auto">
            <option value="">Default (B.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareToggleB" checked />
            <label class="form-check-label" for="fareToggleB">Show B</label>
          </div>
        </div>
        <!-- Icon C -->
        <div class="icon-input-row">
          <select id="fareSelectC" class="form-select w-auto">
            <option value="">Default (C.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareToggleC" checked />
            <label class="form-check-label" for="fareToggleC">Show C</label>
          </div>
        </div>
        <!-- Icon D -->
        <div class="icon-input-row">
          <select id="fareSelectD" class="form-select w-auto">
            <option value="">Default (D.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareToggleD" checked />
            <label class="form-check-label" for="fareToggleD">Show D</label>
          </div>
        </div>
        <!-- Icon E -->
        <div class="icon-input-row">
          <select id="fareSelectE" class="form-select w-auto">
            <option value="">Default (E.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareToggleE" checked />
            <label class="form-check-label" for="fareToggleE">Show E</label>
          </div>
        </div>

        <!-- BADGE SETTINGS -->
        <p class="text-muted mt-3 mb-1">Badge Settings:</p>
        <div class="icon-input-row">
          <input type="text" id="fareBadgeText" class="form-control w-auto" value="2 blocks from our HQ office" />
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="fareBadgeToggle" checked />
            <label class="form-check-label" for="fareBadgeToggle">Show Badge</label>
          </div>
        </div>
      </div>

      <!-- Right column: Hotel Info -->
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Hotel Info:</p>
        <div class="mb-2">
          <label for="fareHotelName" class="form-label">Hotel Name</label>
          <input type="text" id="fareHotelName" class="form-control" value="The James Nomad" />
        </div>
        <div class="mb-2">
          <label for="fareAddress" class="form-label">Address</label>
          <input type="text" id="fareAddress" class="form-control" value="22 East 29th Street, New York, NY 10016" />
        </div>
        <div class="mb-2">
          <label for="fareDistance" class="form-label">Distance</label>
          <input type="text" id="fareDistance" class="form-control" value="2.46 mi" />
        </div>
        <div class="mb-2">
          <label for="farePrice" class="form-label">Price</label>
          <input type="text" id="farePrice" class="form-control" value="$301" />
        </div>
        <div class="mb-2">
          <label for="fareImage" class="form-label">Hotel Image URL</label>
          <input type="text" id="fareImage" class="form-control" value="https://static.concursolutions.com/travel-media/hotels/sabre/image/upload/f_auto,q_auto:best,t_vcmp_medium/hotel/i/313866/alaryry9fpnnumnw1knw.jpg" />
        </div>
        <div class="mb-2">
          <label for="lodgingWidth" class="form-label">Lodging Container Width (px)</label>
          <input type="number" id="lodgingWidth" class="form-control w-auto" value="850" />
        </div>
      </div>
    </div>
    <!-- Buttons -->
    <div class="mt-3">
      <button id="fareResetBtn" class="btn btn-secondary btn-sm">Reset Fare</button>
      <button id="fareRenderBtn" class="btn btn-primary btn-sm">Render Fare</button>
      <button id="copyFareBtn" class="btn btn-outline-warning btn-sm">Copy Fare</button>
      <button id="downloadFareBtn" class="btn btn-warning btn-sm">Download Fare PNG</button>
    </div>

    <!-- FARE PREVIEW -->
    <div class="mt-4" id="farePreview">
      <div class="card border-1 p-3 pb-5 fare-preview-card" style="min-height: 200px;">
        <div class="row g-3">
          <div class="col-3">
            <img id="farePreviewImage" src="https://static.concursolutions.com/travel-media/hotels/sabre/image/upload/f_auto,q_auto:best,t_vcmp_medium/hotel/i/313866/alaryry9fpnnumnw1knw.jpg" alt="The James Nomad" class="img-fluid rounded" />
          </div>
          <div class="col-md-7">
            <div class="d-flex align-items-center fare-preview-icons" id="fareIconsContainer">
              <img id="fareIconA" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/A.png" alt="A" />
              <img id="fareIconB" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/B.png" alt="B" />
              <img id="fareIconC" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/C.png" alt="C" />
              <img id="fareIconD" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/D.png" alt="D" />
              <img id="fareIconE" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/E.png" alt="E" />
              <span class="badge d-flex align-items-center px-3" id="fareBadge" 
                    style="background-color: #e7f0ff; color: #1d2d3e; font-size: 0.9rem; border: 1px solid #427bff; border-radius: 50px; height: 35px;">
                2 blocks from our HQ office
              </span>
            </div>
            <h5 class="fw-bold mt-4" id="farePreviewHotelName">The James Nomad</h5>
            <p class="text-muted mb-1">
              <span id="farePreviewAddress">22 East 29th Street, New York, NY 10016</span>
              <i class="fa-solid fa-location-dot"></i>
              <span id="farePreviewDistance">2.46 mi</span>
            </p>
          </div>
          <div class="col-md-2 text-end d-flex flex-column justify-content-end">
            <p class="mb-1 text-muted small mt-3">From:</p>
            <h4 class="fw-bold text-dark" id="farePreviewPrice">$301</h4>
            <a href="#" class="btn btn-outline-secondary btn-sm" 
               style="background-color: white; border-color: #ddd; color: #005eb8; padding: 6px 6px; min-width: 80px;">
              View Rooms
            </a>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /#lodgingFareSection container -->

  <!-- AIRFARE FARE SECTION (DUPLICATE) -->
  <div class="container fare-section" id="airfareSection">
    <h4>Airfare Auto Fare</h4>
    <div class="row">
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Choose icons and toggles for A–E:</p>
        <div class="icon-input-row">
          <select id="airfareSelectA" class="form-select w-auto">
            <option value="">Default (A.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareToggleA" checked />
            <label class="form-check-label" for="airfareToggleA">Show A</label>
          </div>
        </div>
        <div class="icon-input-row">
          <select id="airfareSelectB" class="form-select w-auto">
            <option value="">Default (B.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareToggleB" checked />
            <label class="form-check-label" for="airfareToggleB">Show B</label>
          </div>
        </div>
        <div class="icon-input-row">
          <select id="airfareSelectC" class="form-select w-auto">
            <option value="">Default (C.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareToggleC" checked />
            <label class="form-check-label" for="airfareToggleC">Show C</label>
          </div>
        </div>
        <div class="icon-input-row">
          <select id="airfareSelectD" class="form-select w-auto">
            <option value="">Default (D.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareToggleD" checked />
            <label class="form-check-label" for="airfareToggleD">Show D</label>
          </div>
        </div>
        <div class="icon-input-row">
          <select id="airfareSelectE" class="form-select w-auto">
            <option value="">Default (E.png)</option>
            <option value="greenLeaf">greenLeaf</option>
            <option value="leaf">leaf</option>
            <option value="business">business</option>
            <option value="breakfast">breakfast</option>
            <option value="dinova">dinova</option>
            <option value="fitness">fitness</option>
            <option value="credits">credits</option>
            <option value="DEI">DEI</option>
            <option value="layover">layover</option>
            <option value="EVCharge">EVCharge</option>
            <option value="minorityOwned">minorityOwned</option>
            <option value="ontime">ontime</option>
            <option value="parking">parking</option>
            <option value="peloton">peloton</option>
            <option value="womenFloor">womenFloor</option>
            <option value="security">security</option>
            <option value="preferred">preferred</option>
            <option value="option18">option18</option>
          </select>
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareToggleE" checked />
            <label class="form-check-label" for="airfareToggleE">Show E</label>
          </div>
        </div>

        <!-- BADGE SETTINGS -->
        <p class="text-muted mt-3 mb-1">Badge Settings:</p>
        <div class="icon-input-row">
          <input type="text" id="airfareBadgeText" class="form-control w-auto" value="2 blocks from our HQ office" />
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="airfareBadgeToggle" checked />
            <label class="form-check-label" for="airfareBadgeToggle">Show Badge</label>
          </div>
        </div>
      </div>
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Airfare Info:</p>
        <div class="mb-2">
          <label for="airfareName" class="form-label">Airfare Name</label>
          <input type="text" id="airfareName" class="form-control" value="NYC to LAX" />
        </div>
        <div class="mb-2">
          <label for="airfareAddress" class="form-label">Origin</label>
          <input type="text" id="airfareAddress" class="form-control" value="JFK Airport" />
        </div>
        <div class="mb-2">
          <label for="airfareDistance" class="form-label">Distance</label>
          <input type="text" id="airfareDistance" class="form-control" value="2,469 miles" />
        </div>
        <div class="mb-2">
          <label for="airfarePrice" class="form-label">Price</label>
          <input type="text" id="airfarePrice" class="form-control" value="$550" />
        </div>
        <div class="mb-2">
          <label for="airfareImage" class="form-label">Airfare Image URL</label>
          <input type="text" id="airfareImage" class="form-control" value="https://www.example.com/plane.jpg" />
        </div>
        <div class="mb-2">
          <label for="airfareWidth" class="form-label">Airfare Container Width (px)</label>
          <input type="number" id="airfareWidth" class="form-control w-auto" value="1000" />
        </div>
      </div>
    </div>
    <div class="mt-3">
      <button id="airfareResetBtn" class="btn btn-secondary btn-sm">Reset Airfare</button>
      <button id="airfareRenderBtn" class="btn btn-primary btn-sm">Render Airfare</button>
      <button id="copyAirfareBtn" class="btn btn-outline-warning btn-sm">Copy Airfare</button>
      <button id="downloadAirfareBtn" class="btn btn-warning btn-sm">Download Airfare PNG</button>
    </div>
    <div class="mt-4" id="airfarePreview">
      <div class="card border-1 shadow p-3 fare-preview-card">
        <div class="row g-3">
          <div class="col-3">
            <img id="airfarePreviewImage" src="https://www.example.com/plane.jpg" alt="Sample Airfare" class="img-fluid rounded" />
          </div>
          <div class="col-md-7">
            <div class="d-flex align-items-center fare-preview-icons" id="airfareIconsContainer">
              <img id="airfareIconA" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/A.png" alt="A" />
              <img id="airfareIconB" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/B.png" alt="B" />
              <img id="airfareIconC" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/C.png" alt="C" />
              <img id="airfareIconD" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/D.png" alt="D" />
              <img id="airfareIconE" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/E.png" alt="E" />
              <span class="badge d-flex align-items-center px-3" id="airfareBadge" style="background-color: #e7f0ff; color: #1d2d3e; border: 1px solid #427bff; border-radius: 50px; height: 35px;">
                2 blocks from our HQ office
              </span>
            </div>
            <h5 class="fw-bold mt-2" id="airfarePreviewName">NYC to LAX</h5>
            <p class="text-muted mb-1">
              <span id="airfarePreviewAddress">JFK Airport</span>
              <i class="fa-solid fa-location-dot"></i>
              <span id="airfarePreviewDistance">2,469 miles</span>
            </p>
          </div>
          <div class="col-md-2 text-end d-flex flex-column justify-content-end">
            <p class="mb-1 text-muted small mt-3">From:</p>
            <h4 class="fw-bold text-dark" id="airfarePreviewPrice">$550</h4>
            <a href="#" class="btn btn-outline-secondary btn-sm" style="background-color: white; border-color: #ddd; color: #005eb8; padding: 6px 6px; min-width: 80px;">
              Book Flight
            </a>
          </div>
        </div>
      </div>
    </div>
  </div> <!-- /#airfareSection container -->

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/selection/active-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/display/placeholder.min.js"></script>
  <!-- HTML2Canvas for copying/downloading images -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- BANNER + TILE LOGIC -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const bannerTypeSelector = document.getElementById("bannerType");
      const cityInputs = document.getElementById("cityInputs");
      const bannerContent = document.getElementById("bannerContent");
      const cityNameInput = document.getElementById("cityName");
      const cityImageUrlInput = document.getElementById("cityImageUrl");
      const tileInputsContainer = document.getElementById("tileInputs");
      const numTilesInput = document.getElementById("numTiles");
      const generateInputsButton = document.getElementById("generateInputs");
      const renderTilesButton = document.getElementById("renderTiles");
      const button2 = document.getElementById("button2");
      const codeView = document.getElementById("codeView");

      let tileEditors = [];
      const tileContainer = document.createElement("div");
      tileContainer.id = "tileContainer";
      tileContainer.className = "col-12";
      tileContainer.style.borderRadius = "10px 0 0 10px";
      const nestedRow = document.createElement("div");
      nestedRow.className = "row g-0";
      tileContainer.appendChild(nestedRow);

      function updateBannerType() {
        bannerContent.innerHTML = "";
        const bannerType = bannerTypeSelector.value;
        const cityName = cityNameInput.value.trim();
        const cityImageUrl = cityImageUrlInput.value.trim();
        if (bannerType === "search") {
          cityInputs.classList.remove("d-none");
          const cityCol = document.createElement("div");
          cityCol.className = "col-2";
          cityCol.style.cssText = "display: flex; flex-direction: column;";
          cityCol.innerHTML = `
            <div class="card card-full"
                style="height: 100%; min-height: 120px; border-radius: 8px 0 0 8px;
                        background-image: url('${cityImageUrl}');
                        background-repeat: no-repeat; background-position: center center;
                        background-size: cover;">
              <div class="card-img-overlay bg-gradient opacity-30 p-0">
                <h4 style="position: absolute; bottom: 0;" class="text-white p-1 ps-2">${cityName}</h4>
              </div>
            </div>
          `;
          const tileCol = document.createElement("div");
          tileCol.className = "col-10 d-flex flex-wrap align-items-stretch";
          tileCol.appendChild(tileContainer);
          const rowContainer = document.createElement("div");
          rowContainer.className = "row g-0";
          rowContainer.appendChild(cityCol);
          rowContainer.appendChild(tileCol);
          bannerContent.appendChild(rowContainer);
        } else {
          cityInputs.classList.add("d-none");
          const tileCol = document.createElement("div");
          tileCol.className = "col-12 d-flex flex-wrap align-items-stretch";
          tileCol.appendChild(tileContainer);
          const rowContainer = document.createElement("div");
          rowContainer.className = "row g-0";
          rowContainer.appendChild(tileCol);
          bannerContent.appendChild(rowContainer);
        }
      }

      function renderTilesMode() {
        nestedRow.innerHTML = "";
        let renderedHTML = "";
        const totalTiles = tileEditors.length;
        let i = 0;
        while (i < totalTiles) {
          const rowSize = Math.min(3, totalTiles - i);
          const rowDiv = document.createElement("div");
          rowDiv.classList.add("row", "g-0");
          let colClass = (rowSize === 2) ? "col-6" : ((rowSize === 1) ? "col-12" : "col-4");
          let groupHTML = "";
          for (let r = 0; r < rowSize; r++) {
            const index = i + r;
            const tileHTML = tileEditors[index].getValue().trim() ||
              `<div class="card border border-2 border-white text-dark bg-light"><div class="card-body">Placeholder Tile</div></div>`;
            const tileWrapper = document.createElement("div");
            tileWrapper.classList.add("tile", colClass);
            tileWrapper.innerHTML = tileHTML;
            rowDiv.appendChild(tileWrapper);
            groupHTML += `<div class="tile ${colClass}">${tileHTML}</div>\n`;
          }
          nestedRow.appendChild(rowDiv);
          renderedHTML += `<div class="row g-0">\n${groupHTML}</div>\n`;
          i += rowSize;
        }
        codeView.textContent = `
<div class="col-12" id="tileContainer" style="border-radius: 10px 0 0 10px;">
  <div class="row g-0">
    ${renderedHTML}
  </div>
</div>`;
        codeView.hidden = false;
      }

      function renderTopFullWidthMode() {
        nestedRow.innerHTML = "";
        let renderedHTML = "";
        const totalTiles = tileEditors.length;
        if (totalTiles > 0) {
          const rowDiv = document.createElement("div");
          rowDiv.classList.add("row", "g-0");
          const tileHTML = tileEditors[0].getValue().trim() ||
            `<div class="card border border-2 border-white text-dark bg-light"><div class="card-body">Placeholder Tile</div></div>`;
          const tileWrapper = document.createElement("div");
          tileWrapper.classList.add("tile", "col-12");
          tileWrapper.innerHTML = tileHTML;
          rowDiv.appendChild(tileWrapper);
          nestedRow.appendChild(rowDiv);
          renderedHTML += `
<div class="row g-0">
  <div class="tile col-12">${tileHTML}</div>
</div>\n`;
          let leftover = totalTiles - 1;
          let currentIndex = 1;
          if (leftover === 3) {
            const rowDiv2 = document.createElement("div");
            rowDiv2.classList.add("row", "g-0");
            let leftoverHTML = "";
            for (let r = 0; r < 3; r++) {
              const index = currentIndex + r;
              const leftoverTileHTML = tileEditors[index].getValue().trim() ||
                `<div class="card border border-2 border-white text-dark bg-light"><div class="card-body">Placeholder Tile</div></div>`;
              const tileWrapper2 = document.createElement("div");
              tileWrapper2.classList.add("tile", "col-4");
              tileWrapper2.innerHTML = leftoverTileHTML;
              rowDiv2.appendChild(tileWrapper2);
              leftoverHTML += `<div class="tile col-4">${leftoverTileHTML}</div>\n`;
            }
            nestedRow.appendChild(rowDiv2);
            leftover = 0;
            renderedHTML += `<div class="row g-0">\n${leftoverHTML}</div>\n`;
          } else {
            while (leftover > 0) {
              const rowSize = Math.min(2, leftover);
              const rowDiv2 = document.createElement("div");
              rowDiv2.classList.add("row", "g-0");
              let leftoverHTML = "";
              const colClass = (rowSize === 2) ? "col-6" : "col-12";
              for (let r = 0; r < rowSize; r++) {
                const index = currentIndex + r;
                const leftoverTileHTML = tileEditors[index].getValue().trim() ||
                  `<div class="card border border-2 border-white text-dark bg-light"><div class="card-body">Placeholder Tile</div></div>`;
                const tileWrapper2 = document.createElement("div");
                tileWrapper2.classList.add("tile", colClass);
                tileWrapper2.innerHTML = leftoverTileHTML;
                rowDiv2.appendChild(tileWrapper2);
                leftoverHTML += `<div class="tile ${colClass}">${leftoverTileHTML}</div>\n`;
              }
              nestedRow.appendChild(rowDiv2);
              renderedHTML += `<div class="row g-0">\n${leftoverHTML}</div>\n`;
              leftover -= rowSize;
              currentIndex += rowSize;
            }
          }
        }
        codeView.textContent = `
<div class="col-12" id="tileContainer" style="border-radius: 10px 0 0 10px;">
  <div class="row g-0">
    ${renderedHTML}
  </div>
</div>`;
        codeView.hidden = false;
      }

      bannerTypeSelector.addEventListener("change", updateBannerType);
      const templateURLs = {
        "1tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/1tileAuto.html",
        "2tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/2tileAuto.html",
        "3tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/3tileAuto.html",
        "4tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/4tileAuto.html",
        "5tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/5tileAuto.html",
        "6tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/6tileAuto.html",
        "7tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/7tileAuto.html",
        "bookNow": "https://info.tripkicks.com/hubfs/mock/auto/bookNow.html",
        "flexDates": "https://info.tripkicks.com/hubfs/mock/auto/flexDates.html",
        "carbonFoot": "https://info.tripkicks.com/hubfs/mock/auto/carbonFoot.html",
        "rateTarget": "https://info.tripkicks.com/hubfs/mock/auto/rateTarget.html",
        "gate4": "https://info.tripkicks.com/hubfs/mock/auto/gate4.html"
      };

      generateInputsButton.addEventListener("click", () => {
        const numTiles = parseInt(numTilesInput.value, 10);
        if (!numTiles || numTiles < 1) {
          alert("Please enter a valid number of tiles.");
          return;
        }
        tileInputsContainer.innerHTML = "";
        tileEditors = [];
        for (let i = 0; i < numTiles; i++) {
          const inputGroup = document.createElement("div");
          inputGroup.classList.add("form-group", "mb-3");
          const editorId = `codeMirrorEditor${i + 1}`;
          const previewId = `livePreview${i + 1}`;
          inputGroup.innerHTML = `
            <div class="d-flex align-items-center justify-content-between mb-2">
              <label for="${editorId}" class="me-2">Tile ${i + 1}</label>
            </div>
            <div class="tile-editor-preview">
              <div class="live-preview" id="${previewId}"></div>
              <div class="code-editor d-flex flex-column">
                <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                  <select class="tile-template-dropdown form-select w-auto">
                    <option value="placeholder" selected>placeholder</option>
                    <option value="1tileAuto">1tileAuto</option>
                    <option value="2tileAuto">2tileAuto</option>
                    <option value="3tileAuto">3tileAuto</option>
                    <option value="4tileAuto">4tileAuto</option>
                    <option value="5tileAuto">5tileAuto</option>
                    <option value="6tileAuto">6tileAuto</option>
                    <option value="7tileAuto">7tileAuto</option>
                    <option value="bookNow">bookNow</option>
                    <option value="flexDates">flexDates</option>
                    <option value="carbonFoot">carbonFoot</option>
                    <option value="rateTarget">rateTarget</option>
                    <option value="gate4">gate4</option>
                  </select>
                  <button type="button" class="btn btn-sm btn-outline-primary copy-code-btn">Copy Code</button>
                </div>
                <textarea id="${editorId}" class="form-control code-editor-textarea" placeholder="Enter HTML for Tile ${i + 1}"></textarea>
              </div>
            </div>
          `;
          tileInputsContainer.appendChild(inputGroup);
          const textarea = inputGroup.querySelector(`#${editorId}`);
          const editor = CodeMirror.fromTextArea(textarea, {
            mode: "htmlmixed",
            theme: "dracula",
            lineNumbers: true,
            styleActiveLine: true,
            lineWrapping: true,
            autoCloseTags: true,
            matchBrackets: true
          });
          tileEditors.push(editor);
          editor.on("change", () => {
            const content = editor.getValue();
            const previewDiv = document.getElementById(previewId);
            if (previewDiv) {
              previewDiv.innerHTML = content;
            }
          });
          const copyButton = inputGroup.querySelector(".copy-code-btn");
          copyButton.addEventListener("click", () => {
            const content = editor.getValue();
            navigator.clipboard.writeText(content)
              .then(() => alert("Code copied to clipboard!"))
              .catch((err) => {
                console.error("Failed to copy: ", err);
                alert("Failed to copy code. Please try manually.");
              });
          });
          const templateDropdown = inputGroup.querySelector(".tile-template-dropdown");
          templateDropdown.addEventListener("change", async () => {
            const selected = templateDropdown.value;
            if (selected === "placeholder") {
              editor.setValue(`
<div class="card border border-2 border-white text-dark bg-light">
  <div class="card-body">Placeholder Tile</div>
</div>
              `.trim());
            } else {
              const url = templateURLs[selected];
              if (!url) return;
              try {
                const response = await fetch(url);
                if (!response.ok) throw new Error("Failed to load template: " + response.status);
                const templateHTML = await response.text();
                editor.setValue(templateHTML.trim());
              } catch (err) {
                console.error("Error loading template:", err);
                alert("Could not load template from " + url);
              }
            }
          });
        });
        renderTilesButton.disabled = false;
      });
      renderTilesButton.addEventListener("click", renderTilesMode);
      if (!button2.hasAttribute("listener")) {
        button2.addEventListener("click", renderTopFullWidthMode);
        button2.setAttribute("listener", "true");
      }
      updateBannerType();
    });
  </script>

  <!-- NEW: Tile & Modal Section Logic -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Toggle the Tile & Modal section visibility
      const toggleBtn = document.getElementById("toggleTileModalBtn");
      const tileModalContent = document.getElementById("tileModalContent");
      toggleBtn.addEventListener("click", function () {
        if (tileModalContent.style.display === "none" || tileModalContent.style.display === "") {
          tileModalContent.style.display = "block";
          toggleBtn.textContent = "Close Tile & Modal";
        } else {
          tileModalContent.style.display = "none";
          toggleBtn.textContent = "Open Tile & Modal";
        }
      });
      
      // Initialize CodeMirror editors for the new section
      const tileHtmlTextarea = document.getElementById("tileHtmlEditor");
      const modalHtmlTextarea = document.getElementById("modalHtmlEditor");
      const tileEditor = CodeMirror.fromTextArea(tileHtmlTextarea, {
        mode: "htmlmixed",
        theme: "dracula",
        lineNumbers: true,
        styleActiveLine: true,
        lineWrapping: true,
        autoCloseTags: true,
        matchBrackets: true
      });
      const modalEditor = CodeMirror.fromTextArea(modalHtmlTextarea, {
        mode: "htmlmixed",
        theme: "dracula",
        lineNumbers: true,
        styleActiveLine: true,
        lineWrapping: true,
        autoCloseTags: true,
        matchBrackets: true
      });
      
      // Update live previews when editors change
      const tilePreview = document.getElementById("tilePreview");
      const modalPreview = document.getElementById("modalPreview");
      tileEditor.on("change", () => { tilePreview.innerHTML = tileEditor.getValue(); });
      modalEditor.on("change", () => { modalPreview.innerHTML = modalEditor.getValue(); });
      
      // Template URLs for Modal templates
      const modalTemplateURLs = {
        "1modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/1modalAuto.html",
        "2modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/2modalAuto.html",
        "3modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/3modalAuto.html",
        "4modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/4modalAuto.html",
        "5modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/5modalAuto.html",
        "6modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/6modalAuto.html",
        "7modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/7modalAuto.html",
        "8modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/8modalAuto.html",
        "9modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/9modalAuto.html",
        "10modalAuto": "https://info.tripkicks.com/hubfs/mock/auto/10modalAuto.html"
      };
      
      // Handle Tile template dropdown change (reuse templateURLs from earlier)
      const tileTemplateDropdown = document.getElementById("tileTemplateDropdown");
      tileTemplateDropdown.addEventListener("change", async () => {
        const selected = tileTemplateDropdown.value;
        if (selected === "placeholder") {
          tileEditor.setValue(`
<div class="card border border-2 border-white text-dark bg-light">
  <div class="card-body">Placeholder Tile</div>
</div>
          `.trim());
        } else {
          const url = templateURLs[selected];
          if (!url) return;
          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to load template: " + response.status);
            const templateHTML = await response.text();
            tileEditor.setValue(templateHTML.trim());
          } catch (err) {
            console.error("Error loading template:", err);
            alert("Could not load template from " + url);
          }
        }
      });
      
      // Handle Modal template dropdown change
      const modalTemplateDropdown = document.getElementById("modalTemplateDropdown");
      modalTemplateDropdown.addEventListener("change", async () => {
        const selected = modalTemplateDropdown.value;
        if (selected === "placeholder") {
          modalEditor.setValue(`
<div class="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Placeholder Modal</h5>
      </div>
      <div class="modal-body">
        <p>This is a placeholder modal.</p>
      </div>
    </div>
  </div>
</div>
          `.trim());
        } else {
          const url = modalTemplateURLs[selected];
          if (!url) return;
          try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("Failed to load modal template: " + response.status);
            const templateHTML = await response.text();
            modalEditor.setValue(templateHTML.trim());
          } catch (err) {
            console.error("Error loading modal template:", err);
            alert("Could not load modal template from " + url);
          }
        }
      });
      
      // Copy code buttons for new editors
      document.getElementById("copyTileCodeBtn").addEventListener("click", () => {
        navigator.clipboard.writeText(tileEditor.getValue())
          .then(() => alert("Tile code copied to clipboard!"))
          .catch(() => alert("Failed to copy tile code."));
      });
      document.getElementById("copyModalCodeBtn").addEventListener("click", () => {
        navigator.clipboard.writeText(modalEditor.getValue())
          .then(() => alert("Modal code copied to clipboard!"))
          .catch(() => alert("Failed to copy modal code."));
      });
      
      // Preview download and copy functionality for the combined preview container
      const previewContainer = document.getElementById("previewContainer");
      document.getElementById("downloadTileModalBtn").addEventListener("click", () => {
        html2canvas(previewContainer, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false
        }).then(canvas => {
          const link = document.createElement("a");
          link.download = "tile-modal-preview.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }).catch(() => alert("Failed to download preview image."));
      });
      document.getElementById("copyTileModalPreviewBtn").addEventListener("click", () => {
        if (!navigator.clipboard || !window.ClipboardItem) {
          alert("Copying images is not supported in your browser.");
          return;
        }
        html2canvas(previewContainer, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false
        }).then(canvas => {
          canvas.toBlob(blob => {
            if (!blob) {
              alert("Failed to generate image blob.");
              return;
            }
            const item = new ClipboardItem({ "image/png": blob });
            navigator.clipboard.write([item])
              .then(() => alert("Preview copied to clipboard!"))
              .catch(() => alert("Failed to copy preview image."));
          }, "image/png");
        }).catch(() => alert("Failed to copy preview image."));
      });
    });
  </script>

  <!-- LODGING FARE LOGIC -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const fareIconA = document.getElementById("fareIconA");
      const fareIconB = document.getElementById("fareIconB");
      const fareIconC = document.getElementById("fareIconC");
      const fareIconD = document.getElementById("fareIconD");
      const fareIconE = document.getElementById("fareIconE");
      const defaultFareValues = {
        hotelName: "The James Nomad",
        address: "22 East 29th Street, New York, NY 10016",
        distance: "2.46 mi",
        price: "$301",
        image: "https://static.concursolutions.com/travel-media/hotels/sabre/image/upload/f_auto,q_auto:best,t_vcmp_medium/hotel/i/313866/alaryry9fpnnumnw1knw.jpg",
        badgeText: "2 blocks from our HQ office"
      };
      const fareSelectA = document.getElementById("fareSelectA");
      const fareSelectB = document.getElementById("fareSelectB");
      const fareSelectC = document.getElementById("fareSelectC");
      const fareSelectD = document.getElementById("fareSelectD");
      const fareSelectE = document.getElementById("fareSelectE");
      const fareToggleA = document.getElementById("fareToggleA");
      const fareToggleB = document.getElementById("fareToggleB");
      const fareToggleC = document.getElementById("fareToggleC");
      const fareToggleD = document.getElementById("fareToggleD");
      const fareToggleE = document.getElementById("fareToggleE");
      const fareHotelName = document.getElementById("fareHotelName");
      const fareAddress = document.getElementById("fareAddress");
      const fareDistance = document.getElementById("fareDistance");
      const farePrice = document.getElementById("farePrice");
      const fareImage = document.getElementById("fareImage");
      const fareBadgeText = document.getElementById("fareBadgeText");
      const fareBadgeToggle = document.getElementById("fareBadgeToggle");
      const fareBadge = document.getElementById("fareBadge");
      const fareResetBtn = document.getElementById("fareResetBtn");
      const fareRenderBtn = document.getElementById("fareRenderBtn");
      const copyFareBtn = document.getElementById("copyFareBtn");
      const downloadFareBtn = document.getElementById("downloadFareBtn");
      const farePreview = document.getElementById("farePreview");
      const fareIconsContainer = document.getElementById("fareIconsContainer");
      const farePreviewImage = document.getElementById("farePreviewImage");
      const farePreviewHotelName = document.getElementById("farePreviewHotelName");
      const farePreviewAddress = document.getElementById("farePreviewAddress");
      const farePreviewDistance = document.getElementById("farePreviewDistance");
      const farePreviewPrice = document.getElementById("farePreviewPrice");
      fareResetBtn.addEventListener("click", resetFare);
      fareRenderBtn.addEventListener("click", renderFare);
      copyFareBtn.addEventListener("click", copyFareToClipboard);
      downloadFareBtn.addEventListener("click", downloadFareAsPNG);
      function renderFare() {
        updateIcon("A", fareToggleA.checked, fareSelectA.value, fareIconA);
        updateIcon("B", fareToggleB.checked, fareSelectB.value, fareIconB);
        updateIcon("C", fareToggleC.checked, fareSelectC.value, fareIconC);
        updateIcon("D", fareToggleD.checked, fareSelectD.value, fareIconD);
        updateIcon("E", fareToggleE.checked, fareSelectE.value, fareIconE);
        reorderIcons();
        farePreviewHotelName.textContent = fareHotelName.value.trim() || defaultFareValues.hotelName;
        farePreviewAddress.textContent = fareAddress.value.trim() || defaultFareValues.address;
        farePreviewDistance.textContent = fareDistance.value.trim() || defaultFareValues.distance;
        farePreviewPrice.textContent = farePrice.value.trim() || defaultFareValues.price;
        farePreviewImage.crossOrigin = "anonymous";
        const newImageUrl = fareImage.value.trim() || defaultFareValues.image;
        farePreviewImage.src = newImageUrl;
        if (fareBadgeToggle.checked) {
          fareBadge.style.display = "";
          fareBadge.textContent = fareBadgeText.value.trim() || defaultFareValues.badgeText;
        } else {
          fareBadge.style.display = "none";
        }
        const lodgingWidthInput = document.getElementById("lodgingWidth");
        if (lodgingWidthInput) {
          const newWidth = parseInt(lodgingWidthInput.value, 10);
          farePreview.style.width = (!isNaN(newWidth) && newWidth > 0) ? newWidth + "px" : "auto";
        }
      }
      function resetFare() {
        fareToggleA.checked = fareToggleB.checked = fareToggleC.checked = fareToggleD.checked = fareToggleE.checked = true;
        fareSelectA.value = fareSelectB.value = fareSelectC.value = fareSelectD.value = fareSelectE.value = "";
        fareBadgeToggle.checked = true;
        fareBadgeText.value = defaultFareValues.badgeText;
        fareHotelName.value = defaultFareValues.hotelName;
        fareAddress.value = defaultFareValues.address;
        fareDistance.value = defaultFareValues.distance;
        farePrice.value = defaultFareValues.price;
        fareImage.value = defaultFareValues.image;
        renderFare();
      }
      function updateIcon(letter, isOn, selectedValue, iconElement) {
        const defaultIconUrl = `https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/${letter}.png`;
        if (!isOn) {
          iconElement.style.display = "none";
        } else {
          iconElement.style.display = "";
          iconElement.src = selectedValue ? `https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/${selectedValue}.png` : defaultIconUrl;
        }
      }
      function reorderIcons() {
        const visibleIcons = [];
        [fareIconA, fareIconB, fareIconC, fareIconD, fareIconE].forEach((icon) => {
          if (icon.style.display !== "none") visibleIcons.push(icon);
        });
        fareIconsContainer.innerHTML = "";
        visibleIcons.forEach((icon) => fareIconsContainer.appendChild(icon));
        if (fareBadgeToggle.checked) fareIconsContainer.appendChild(fareBadge);
      }
      function copyFareToClipboard() {
        if (!navigator.clipboard || !window.ClipboardItem) {
          alert("Copying images to the clipboard is not supported in your browser.");
          return;
        }
        const boundingRect = farePreview.getBoundingClientRect();
        const maxWidth = 1400;
        const finalWidth = Math.min(boundingRect.width, maxWidth);
        const finalHeight = boundingRect.height;
        html2canvas(farePreview, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false,
          windowWidth: 1400,
          windowHeight: finalHeight
        }).then((canvas) => {
          canvas.toBlob((blob) => {
            if (!blob) { alert("Failed to generate image blob."); return; }
            const item = new ClipboardItem({ "image/png": blob });
            navigator.clipboard.write([item]).then(() => { alert("Fare copied to clipboard!"); })
              .catch((err) => { alert("Failed to copy fare. Your browser might not support this feature."); });
          }, "image/png");
        }).catch((error) => { alert("Failed to capture fare. Check console for details."); });
      }
      function downloadFareAsPNG() {
        const boundingRect = farePreview.getBoundingClientRect();
        const maxWidth = 1400;
        const finalWidth = Math.min(boundingRect.width, maxWidth);
        const finalHeight = boundingRect.height;
        html2canvas(farePreview, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false,
          windowWidth: 1400,
          windowHeight: finalHeight
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "fare.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }).catch((error) => { alert("Failed to capture fare. Check console for details."); });
      }
      renderFare();
    });
  </script>

  <!-- AIRFARE LOGIC -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const airfareIconA = document.getElementById("airfareIconA");
      const airfareIconB = document.getElementById("airfareIconB");
      const airfareIconC = document.getElementById("airfareIconC");
      const airfareIconD = document.getElementById("airfareIconD");
      const airfareIconE = document.getElementById("airfareIconE");
      const defaultAirfareValues = {
        name: "NYC to LAX",
        address: "JFK Airport",
        distance: "2,469 miles",
        price: "$550",
        image: "https://www.example.com/plane.jpg",
        badgeText: "2 blocks from our HQ office"
      };
      const airfareSelectA = document.getElementById("airfareSelectA");
      const airfareSelectB = document.getElementById("airfareSelectB");
      const airfareSelectC = document.getElementById("airfareSelectC");
      const airfareSelectD = document.getElementById("airfareSelectD");
      const airfareSelectE = document.getElementById("airfareSelectE");
      const airfareToggleA = document.getElementById("airfareToggleA");
      const airfareToggleB = document.getElementById("airfareToggleB");
      const airfareToggleC = document.getElementById("airfareToggleC");
      const airfareToggleD = document.getElementById("airfareToggleD");
      const airfareToggleE = document.getElementById("airfareToggleE");
      const airfareName = document.getElementById("airfareName");
      const airfareAddress = document.getElementById("airfareAddress");
      const airfareDistance = document.getElementById("airfareDistance");
      const airfarePrice = document.getElementById("airfarePrice");
      const airfareImage = document.getElementById("airfareImage");
      const airfareBadgeText = document.getElementById("airfareBadgeText");
      const airfareBadgeToggle = document.getElementById("airfareBadgeToggle");
      const airfareBadge = document.getElementById("airfareBadge");
      const airfareResetBtn = document.getElementById("airfareResetBtn");
      const airfareRenderBtn = document.getElementById("airfareRenderBtn");
      const copyAirfareBtn = document.getElementById("copyAirfareBtn");
      const downloadAirfareBtn = document.getElementById("downloadAirfareBtn");
      const airfarePreview = document.getElementById("airfarePreview");
      const airfareIconsContainer = document.getElementById("airfareIconsContainer");
      const airfarePreviewImage = document.getElementById("airfarePreviewImage");
      const airfarePreviewName = document.getElementById("airfarePreviewName");
      const airfarePreviewAddress = document.getElementById("airfarePreviewAddress");
      const airfarePreviewDistance = document.getElementById("airfarePreviewDistance");
      const airfarePreviewPrice = document.getElementById("airfarePreviewPrice");
      airfareResetBtn.addEventListener("click", resetAirfare);
      airfareRenderBtn.addEventListener("click", renderAirfare);
      copyAirfareBtn.addEventListener("click", copyAirfareToClipboard);
      downloadAirfareBtn.addEventListener("click", downloadAirfareAsPNG);
      function renderAirfare() {
        updateAirfareIcon("A", airfareToggleA.checked, airfareSelectA.value, airfareIconA);
        updateAirfareIcon("B", airfareToggleB.checked, airfareSelectB.value, airfareIconB);
        updateAirfareIcon("C", airfareToggleC.checked, airfareSelectC.value, airfareIconC);
        updateAirfareIcon("D", airfareToggleD.checked, airfareSelectD.value, airfareIconD);
        updateAirfareIcon("E", airfareToggleE.checked, airfareSelectE.value, airfareIconE);
        reorderAirfareIcons();
        airfarePreviewName.textContent = airfareName.value.trim() || defaultAirfareValues.name;
        airfarePreviewAddress.textContent = airfareAddress.value.trim() || defaultAirfareValues.address;
        airfarePreviewDistance.textContent = airfareDistance.value.trim() || defaultAirfareValues.distance;
        airfarePreviewPrice.textContent = airfarePrice.value.trim() || defaultAirfareValues.price;
        airfarePreviewImage.crossOrigin = "anonymous";
        const newImageUrl = airfareImage.value.trim() || defaultAirfareValues.image;
        airfarePreviewImage.src = newImageUrl;
        if (airfareBadgeToggle.checked) {
          airfareBadge.style.display = "";
          airfareBadge.textContent = airfareBadgeText.value.trim() || defaultAirfareValues.badgeText;
        } else {
          airfareBadge.style.display = "none";
        }
        const airfareWidthInput = document.getElementById("airfareWidth");
        if (airfareWidthInput) {
          const newWidth = parseInt(airfareWidthInput.value, 10);
          airfarePreview.style.width = (!isNaN(newWidth) && newWidth > 0) ? newWidth + "px" : "auto";
        }
      }
      function resetAirfare() {
        airfareToggleA.checked = airfareToggleB.checked = airfareToggleC.checked = airfareToggleD.checked = airfareToggleE.checked = true;
        airfareSelectA.value = airfareSelectB.value = airfareSelectC.value = airfareSelectD.value = airfareSelectE.value = "";
        airfareBadgeToggle.checked = true;
        airfareBadgeText.value = defaultAirfareValues.badgeText;
        airfareName.value = defaultAirfareValues.name;
        airfareAddress.value = defaultAirfareValues.address;
        airfareDistance.value = defaultAirfareValues.distance;
        airfarePrice.value = defaultAirfareValues.price;
        airfareImage.value = defaultAirfareValues.image;
        renderAirfare();
      }
      function updateAirfareIcon(letter, isOn, selectedValue, iconElement) {
        const defaultIconUrl = `https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/${letter}.png`;
        if (!isOn) {
          iconElement.style.display = "none";
        } else {
          iconElement.style.display = "";
          iconElement.src = selectedValue ? `https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/${selectedValue}.png` : defaultIconUrl;
        }
      }
      function reorderAirfareIcons() {
        const visibleIcons = [];
        [airfareIconA, airfareIconB, airfareIconC, airfareIconD, airfareIconE].forEach((icon) => {
          if (icon.style.display !== "none") visibleIcons.push(icon);
        });
        airfareIconsContainer.innerHTML = "";
        visibleIcons.forEach((icon) => airfareIconsContainer.appendChild(icon));
        if (airfareBadgeToggle.checked) airfareIconsContainer.appendChild(airfareBadge);
      }
      function copyAirfareToClipboard() {
        if (!navigator.clipboard || !window.ClipboardItem) {
          alert("Copying images to the clipboard is not supported in your browser.");
          return;
        }
        const boundingRect = airfarePreview.getBoundingClientRect();
        const maxWidth = 900;
        const finalWidth = Math.min(boundingRect.width, maxWidth);
        const finalHeight = boundingRect.height;
        html2canvas(airfarePreview, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false,
          windowWidth: 1200,
          windowHeight: finalHeight
        }).then((canvas) => {
          canvas.toBlob((blob) => {
            if (!blob) { alert("Failed to generate image blob."); return; }
            const item = new ClipboardItem({ "image/png": blob });
            navigator.clipboard.write([item]).then(() => { alert("Airfare copied to clipboard!"); })
              .catch((err) => { alert("Failed to copy airfare."); });
          }, "image/png");
        }).catch((error) => { alert("Failed to capture airfare."); });
      }
      function downloadAirfareAsPNG() {
        const boundingRect = airfarePreview.getBoundingClientRect();
        const maxWidth = 1400;
        const finalWidth = Math.min(boundingRect.width, maxWidth);
        const finalHeight = boundingRect.height;
        html2canvas(airfarePreview, {
          scale: 4,
          backgroundColor: null,
          useCORS: true,
          allowTaint: false,
          windowWidth: 1400,
          windowHeight: finalHeight
        }).then((canvas) => {
          const link = document.createElement("a");
          link.download = "airfare.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }).catch((error) => { alert("Failed to capture airfare."); });
      }
      renderAirfare();
    });
  </script>

  <!-- COPY BANNER & DOWNLOAD BANNER Scripts -->
  <script>
    const container = document.querySelector(".container");
    const buttonWrapper = document.createElement("div");
    buttonWrapper.classList.add("d-flex", "gap-2", "mt-4");
    const copyButton = document.createElement("button");
    copyButton.textContent = "Copy Banner";
    copyButton.classList.add("btn", "btn-outline-warning");
    copyButton.onclick = copyBannerToClipboard;
    const downloadButton = document.createElement("button");
    downloadButton.textContent = "Download Banner PNG";
    downloadButton.classList.add("btn", "btn-warning");
    downloadButton.onclick = downloadBannerAsPNG;
    buttonWrapper.appendChild(copyButton);
    buttonWrapper.appendChild(downloadButton);
    container.appendChild(buttonWrapper);
    if (!navigator.clipboard || !window.ClipboardItem) {
      copyButton.disabled = true;
      copyButton.title = "Copying images to the clipboard is not supported in your browser.";
    }
    function downloadBannerAsPNG() {
      const banner = document.getElementById("pageBanner");
      const scaleFactor = 3;
      html2canvas(banner, {
        scale: scaleFactor,
        backgroundColor: null,
        useCORS: true,
        allowTaint: false
      }).then((canvas) => {
        const link = document.createElement("a");
        link.download = "banner.png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      }).catch((error) => {
        console.error("Error capturing banner:", error);
        alert("Failed to capture banner. Check console for details.");
      });
    }
    function copyBannerToClipboard() {
      if (!navigator.clipboard || !window.ClipboardItem) {
        alert("Copying images to the clipboard is not supported in your browser.");
        return;
      }
      const banner = document.getElementById("pageBanner");
      const scaleFactor = 3;
      html2canvas(banner, {
        scale: scaleFactor,
        backgroundColor: null,
        useCORS: true,
        allowTaint: false
      }).then((canvas) => {
        canvas.toBlob((blob) => {
          if (!blob) { alert("Failed to generate image blob."); return; }
          const item = new ClipboardItem({ "image/png": blob });
          navigator.clipboard.write([item]).then(() => { alert("Banner copied to clipboard!"); })
            .catch((err) => { alert("Failed to copy banner. Your browser might not support this feature."); });
        }, "image/png");
      }).catch((error) => {
        console.error("Error capturing banner:", error);
        alert("Failed to capture banner. Check console for details.");
      });
    }
  </script>
</body>
</html>