<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>tkAuto</title>
  <link rel="icon" href="https://info.tripkicks.com/hubfs/mock/auto/tkAfav.png" type="image/x-icon" />

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://info.tripkicks.com/hubfs/system/mockup/tk-css.css" rel="stylesheet" type="text/css" />

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css" />

  <style>
    :root {
      --tk-white-rgb: 255, 255, 255;
    }
    .tile {
      padding: 0;
    }
    .tile .card {
      width: 100%;
      margin: 0;
      border-radius: 0;
      border: 2px solid rgba(var(--tk-white-rgb), 1);
    }
    #tileInputs {
      margin-top: 20px;
      padding-bottom: 20px;
    }
    /* Updated CSS selector to #pageBanner as per colleague's suggestion */
    #pageBanner {
      /* Styles previously under #banner. Commented out as pageBanner gets styling elsewhere. */
      /* margin-top: 20px; */
      /* border: 1px solid #ddd; */
      /* padding: 10px; */
      /* border-radius: 8px; */
    }
    #codeViewContainer {
      margin-top: 20px;
    }
    #codeView {
      padding: 10px;
      background: #f8f9fa;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 600px;
      overflow: auto;
    }
    .tile-editor-preview {
      display: flex;
      flex-direction: row;
      gap: 10px;
      margin-bottom: 20px;
    }
    .live-preview {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 10px;
      background-color: #ffffff;
      overflow: auto;
      min-height: 200px;
      max-width: 30%;
      flex-shrink: 0;
    }
    .code-editor {
      position: relative;
      flex-grow: 1;
    }
    .copy-code-btn {
      margin-top: 10px;
    }
    .CodeMirror {
      min-height: 100px;
      max-height: 280px;
      overflow: auto !important;
      border-radius: 8px;
      border: 1px solid #ddd;
      font-size: 0.98rem;
    }
    .CodeMirror-scroll {
      overflow-y: scroll !important;
      margin-right: 0 !important;
      padding-right: 0 !important;
    }
    .CodeMirror-focused {
      border-color: #427bff;
      box-shadow: 0 0 2px #427bff55;
    }
    @media (max-width: 1200px) {
      .tile-editor-preview {
        flex-direction: column;
      }
      .live-preview,
      .code-editor {
        width: 100%;
      }
    }
    .fare-section {
      margin-top: 40px;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      background-color: #fdfdfd;
    }
    .fare-section h4 {
      margin-bottom: 20px;
    }
    .icon-input-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .fare-preview-card {
      max-width: 1500px;
    }
    #farePreviewWrapper, #airfarePreviewWrapper {
        max-width: 1500px;
    }
    .fare-preview-icons img {
      height: 35px;
      margin-right: 3px;
    }
    .fare-inputs .form-check {
      margin-left: 10px;
    }
    #farePreviewImage, #airfarePreviewImage {
      width: 100%;
      object-fit: cover;
      object-position: center;
    }
    #farePreviewImage {
        aspect-ratio: 1/1;
    }
    #airfarePreviewImage {
        aspect-ratio: auto;
        max-height: 150px;
    }
  </style>
</head>
<body>
<header style="display: flex; align-items: center; padding: 20px; margin-bottom: 20px; background-color: #e5efff;">
  <a href="#" style="font-size: 12px; font-weight: bold; text-decoration: none; color: #4d5466; margin: 0 15px;">tkAuto</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Banner</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Fares</a>
  <a href="https://tripkickshq.github.io/tkautotest/tkAuto.html" style="font-size: 12px; text-decoration: none; color: #4d5466; margin: 0 15px;">Insights</a>
  <span class="badge rounded-pill text-primary border border-primary ms-auto" style="font-size: 0.62rem; padding: 0.5em 1em; opacity: 0.6; cursor: not-allowed; pointer-events: none;">
    05.25.25
  </span>
</header>
  <div class="container">
    <div class="d-flex align-items-center mb-3">
      <label for="bannerType" class="me-3 fs-6 fw-lighter">Select Banner Type:</label>
      <select id="bannerType" class="form-select w-auto">
        <option value="search">Search (with city image)</option>
        <option value="anytime">Anytime (without city image)</option>
      </select>
      <div id="cityInputs" class="d-flex align-items-center ms-4 d-none">
        <label for="cityName" class="me-2 fs-6 fw-lighter">City:</label>
        <input type="text" id="cityName" class="form-control me-3" placeholder="Enter city name" value="New York City" />
        <label for="cityImageUrl" class="me-2 fs-6 fw-lighter">URL:</label>
        <input type="text" id="cityImageUrl" class="form-control" placeholder="Enter image URL" value="https://info.tripkicks.com/hubfs/ClientInsights/tkDemo/cityimage_NYC.png" />
      </div>
    </div>

    <div class="tk_css" id="pageBanner">
      <div class="row">
        <div class="col-12 mb-2">
          <div class="card border border-primary z-0" style="border-radius: 10px 10px 0 10px; z-index: 1;">
            <div class="card-body p-0">
              <div class="row g-0" id="bannerContent">
                </div>
            </div>
          </div>
          <div class="border border-primary border-top-0 z-3 bg-white ps-2"
               style="float: right; width: 136px; position: relative; z-index: 1000; border-top: 5px solid white; border-bottom-left-radius: 8px; box-shadow: 0 0 0 0 rgba(16, 24, 40, 0.03); margin-top: -1px;">
            <div style="justify-content: flex-start; align-items: center; display: flex;">
              <div style="text-align: right; color: #326bf4; font-size: 8px; font-family: 'Helvetica Neue', sans-serif; font-weight: 300; line-height: 18px; white-space: nowrap;">
                powered by
              </div>
              <img style="margin-left: 5px; width: 70px;" src="https://info.tripkicks.com/hubfs/system/tkEmail150.png" alt="Tripkicks Logo" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex gap-2 mt-4">
      <button id="copyBannerBtn" class="btn btn-outline-warning">Copy Banner</button>
      <button id="downloadBannerBtn" class="btn btn-warning">Download Banner PNG</button>
    </div>

    <div id="tileInputs">
          <div class="form-group fs-6 fw-lighter col-sm-3 pb-2">
          <label for="numTiles">Number of Tiles:</label>
          <input type="number" id="numTiles" class="form-control" min="1" placeholder="Enter number of tiles" />
        </div>
        <button id="generateInputs" class="btn btn-primary btn-sm">Generate Tile Inputs</button>
        </div>

    <button id="renderTiles" class="btn btn-success btn-sm mt-3" disabled>Render Tiles</button>
    <button id="button2" class="btn btn-success btn-sm mt-3">Render Top Full-Width</button>
    <button id="button3" class="btn btn-secondary btn-sm mt-3" disabled>Button 3</button>

    <div id="codeViewContainer" class="mt-4">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="mb-0">Rendered HTML</h5>
      </div>
        <pre id="codeView" hidden></pre>
    </div>

    <div class="container fare-section" id="tileModalSection" style="margin-top: 40px;">
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h4>Tile & Modal Preview</h4>
        <button id="toggleTileModalBtn" class="btn btn-primary btn-sm">Open Tile & Modal</button>
      </div>
      <div id="tileModalContent" style="display: none;">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label for="tileHtmlEditor" class="fw-lighter">Tile HTML</label>
              <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                <select id="tileTemplateDropdown" class="form-select w-auto">
                    <option value="placeholder" selected>placeholder</option>
                  <option value="1tileAuto">1tileAuto</option>
                  <option value="gate4">gate4</option>
                </select>
                <button id="copyTileCodeBtn" type="button" class="btn btn-sm btn-outline-primary">Copy Code</button>
              </div>
              <textarea id="tileHtmlEditor" class="form-control" placeholder="Enter HTML for Tile"></textarea>
            </div>
            <div class="form-group mb-3">
              <label for="modalHtmlEditor" class="fw-lighter">Modal HTML</label>
              <div class="d-flex align-items-center mb-2" style="gap: 10px;">
                <select id="modalTemplateDropdown" class="form-select w-auto">
                  <option value="placeholder" selected>placeholder</option>
                  <option value="1modalAuto">1modalAuto</option>
                  <option value="10modalAuto">10modalAuto</option>
                </select>
                <button id="copyModalCodeBtn" type="button" class="btn btn-sm btn-outline-primary">Copy Code</button>
              </div>
              <textarea id="modalHtmlEditor" class="form-control" placeholder="Enter HTML for Modal"></textarea>
             </div>
          </div>
          <div class="col-md-6">
            <div id="previewContainer">
              <div id="tilePreview" style="border: 1px solid #ddd; border-radius: 8px; margin-bottom: 10px; width: 100%;"></div>
              <div id="modalPreview" style="width: 100%; aspect-ratio: 464 / 600;"></div>
            </div>
            <div class="mt-2 d-flex gap-2">
              <button id="downloadTileModalBtn" type="button" class="btn btn-warning btn-sm">Download Preview PNG</button>
              <button id="copyTileModalPreviewBtn" type="button" class="btn btn-outline-warning btn-sm">Copy Preview</button>
            </div>
          </div>
         </div>
      </div>
    </div>

    <div class="container fare-section" id="lodgingFareSection">
    <h4>Lodging Auto Fare</h4>
    <div class="row">
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Choose icons and toggles for A–E:</p>
        <div class="icon-input-row">
          <select id="fareSelectA" class="form-select w-auto"> <option value="">Default (A.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareToggleA" checked /> <label class="form-check-label" for="fareToggleA">Show A</label> </div>
        </div>
        <div class="icon-input-row">
          <select id="fareSelectB" class="form-select w-auto"> <option value="">Default (B.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareToggleB" checked /> <label class="form-check-label" for="fareToggleB">Show B</label> </div>
        </div>
        <div class="icon-input-row">
          <select id="fareSelectC" class="form-select w-auto"> <option value="">Default (C.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareToggleC" checked /> <label class="form-check-label" for="fareToggleC">Show C</label> </div>
        </div>
        <div class="icon-input-row">
          <select id="fareSelectD" class="form-select w-auto"> <option value="">Default (D.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareToggleD" checked /> <label class="form-check-label" for="fareToggleD">Show D</label> </div>
        </div>
        <div class="icon-input-row">
          <select id="fareSelectE" class="form-select w-auto"> <option value="">Default (E.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareToggleE" checked /> <label class="form-check-label" for="fareToggleE">Show E</label> </div>
        </div>
        <p class="text-muted mt-3 mb-1">Badge Settings:</p>
        <div class="icon-input-row">
          <input type="text" id="fareBadgeText" class="form-control w-auto" value="2 blocks from our HQ office" /> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="fareBadgeToggle" checked /> <label class="form-check-label" for="fareBadgeToggle">Show Badge</label> </div>
        </div>
      </div>
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Hotel Info:</p>
        <div class="mb-2"> <label for="fareHotelName" class="form-label">Hotel Name</label> <input type="text" id="fareHotelName" class="form-control" value="The James Nomad" /> </div> <div class="mb-2"> <label for="fareAddress" class="form-label">Address</label> <input type="text" id="fareAddress" class="form-control" value="22 East 29th Street, New York, NY 10016" /> </div> <div class="mb-2"> <label for="fareDistance" class="form-label">Distance</label> <input type="text" id="fareDistance" class="form-control" value="2.46 mi" /> </div> <div class="mb-2"> <label for="farePrice" class="form-label">Price</label> <input type="text" id="farePrice" class="form-control" value="$301" /> </div> <div class="mb-2"> <label for="fareImage" class="form-label">Hotel Image URL</label> <input type="text" id="fareImage" class="form-control" value="https://static.concursolutions.com/travel-media/hotels/sabre/image/upload/f_auto,q_auto:best,t_vcmp_medium/hotel/i/313866/alaryry9fpnnumnw1knw.jpg" /> </div> <div class="mb-2"> <label for="lodgingWidth" class="form-label">Lodging Container Width (px)</label> <input type="number" id="lodgingWidth" class="form-control w-auto" value="850" /> </div>
      </div>
    </div>
    <div class="mt-3">
      <button id="fareResetBtn" class="btn btn-secondary btn-sm">Reset Fare</button>
       <button id="fareRenderBtn" class="btn btn-primary btn-sm">Render Fare</button>
      <button id="copyFareBtn" class="btn btn-outline-warning btn-sm">Copy Fare</button>
      <button id="downloadFareBtn" class="btn btn-warning btn-sm">Download Fare PNG</button>
    </div>
    <div class="mt-4" id="farePreviewWrapper">
      <div class="card border-1 p-3 pb-5 fare-preview-card" id="farePreview">
        <div class="row g-3"> <div class="col-3"> <img id="farePreviewImage" src="https://static.concursolutions.com/travel-media/hotels/sabre/image/upload/f_auto,q_auto:best,t_vcmp_medium/hotel/i/313866/alaryry9fpnnumnw1knw.jpg" alt="The James Nomad" class="img-fluid rounded" crossOrigin="anonymous" /> </div> <div class="col-md-7"> <div class="d-flex align-items-center fare-preview-icons" id="fareIconsContainer"> <img id="fareIconA" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/A.png" alt="A" /> <img id="fareIconB" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/B.png" alt="B" /> <img id="fareIconC" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/C.png" alt="C" /> <img id="fareIconD" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/D.png" alt="D" /> <img id="fareIconE" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/E.png" alt="E" /> <span class="badge d-flex align-items-center px-3" id="fareBadge" style="background-color: #e7f0ff; color: #1d2d3e; font-size: 0.9rem; border: 1px solid #427bff; border-radius: 50px; height: 35px;"> 2 blocks from our HQ office </span> </div> <h5 class="fw-bold mt-4" id="farePreviewHotelName">The James Nomad</h5> <p class="text-muted mb-1"> <span id="farePreviewAddress">22 East 29th Street, New York, NY 10016</span> <i class="fa-solid fa-location-dot"></i> <span id="farePreviewDistance">2.46 mi</span> </p> </div> <div class="col-md-2 text-end d-flex flex-column justify-content-end"> <p class="mb-1 text-muted small mt-3">From:</p> <h4 class="fw-bold text-dark" id="farePreviewPrice">$301</h4> <a href="#" class="btn btn-outline-secondary btn-sm" style="background-color: white; border-color: #ddd; color: #005eb8; padding: 6px 6px; min-width: 80px;"> View Rooms </a> </div> </div>
      </div>
    </div>
  </div>

  <div class="container fare-section" id="airfareSection">
    <h4>Airfare Auto Fare</h4>
    <div class="row">
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Choose icons and toggles for A–E:</p>
        <div class="icon-input-row"> <select id="airfareSelectA" class="form-select w-auto"> <option value="">Default (A.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareToggleA" checked /> <label class="form-check-label" for="airfareToggleA">Show A</label> </div> </div> <div class="icon-input-row"> <select id="airfareSelectB" class="form-select w-auto"> <option value="">Default (B.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareToggleB" checked /> <label class="form-check-label" for="airfareToggleB">Show B</label> </div> </div> <div class="icon-input-row"> <select id="airfareSelectC" class="form-select w-auto"> <option value="">Default (C.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareToggleC" checked /> <label class="form-check-label" for="airfareToggleC">Show C</label> </div> </div> <div class="icon-input-row"> <select id="airfareSelectD" class="form-select w-auto"> <option value="">Default (D.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareToggleD" checked /> <label class="form-check-label" for="airfareToggleD">Show D</label> </div> </div> <div class="icon-input-row"> <select id="airfareSelectE" class="form-select w-auto"> <option value="">Default (E.png)</option> <option value="greenLeaf">greenLeaf</option> <option value="option18">option18</option> </select> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareToggleE" checked /> <label class="form-check-label" for="airfareToggleE">Show E</label> </div> </div>
        <p class="text-muted mt-3 mb-1">Badge Settings:</p>
        <div class="icon-input-row">
          <input type="text" id="airfareBadgeText" class="form-control w-auto" value="On-time arrival 85%" /> <div class="form-check form-switch"> <input class="form-check-input" type="checkbox" id="airfareBadgeToggle" checked /> <label class="form-check-label" for="airfareBadgeToggle">Show Badge</label> </div>
        </div>
      </div>
      <div class="col-md-6 fare-inputs">
        <p class="text-muted mb-2">Airfare Info:</p>
        <div class="mb-2"> <label for="airfareName" class="form-label">Airfare Name</label> <input type="text" id="airfareName" class="form-control" value="NYC to LAX" /> </div> <div class="mb-2"> <label for="airfareAddress" class="form-label">Origin</label> <input type="text" id="airfareAddress" class="form-control" value="JFK Airport" /> </div> <div class="mb-2"> <label for="airfareDistance" class="form-label">Distance</label> <input type="text" id="airfareDistance" class="form-control" value="2,469 miles" /> </div> <div class="mb-2"> <label for="airfarePrice" class="form-label">Price</label> <input type="text" id="airfarePrice" class="form-control" value="$550" /> </div> <div class="mb-2"> <label for="airfareImage" class="form-label">Airfare Image URL</label> <input type="text" id="airfareImage" class="form-control" value="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/airport-1.png" /> </div> <div class="mb-2"> <label for="airfareWidth" class="form-label">Airfare Container Width (px)</label> <input type="number" id="airfareWidth" class="form-control w-auto" value="1000" /> </div>
      </div>
    </div>
    <div class="mt-3">
      <button id="airfareResetBtn" class="btn btn-secondary btn-sm">Reset Airfare</button>
      <button id="airfareRenderBtn" class="btn btn-primary btn-sm">Render Airfare</button>
      <button id="copyAirfareBtn" class="btn btn-outline-warning btn-sm">Copy Airfare</button>
      <button id="downloadAirfareBtn" class="btn btn-warning btn-sm">Download Airfare PNG</button>
    </div>
    <div class="mt-4" id="airfarePreviewWrapper">
      <div class="card border-1 shadow p-3 fare-preview-card" id="airfarePreview">
        <div class="row g-3"> <div class="col-3"> <img id="airfarePreviewImage" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/airport-1.png" alt="Sample Airfare" class="img-fluid rounded" crossOrigin="anonymous"/> </div> <div class="col-md-7"> <div class="d-flex align-items-center fare-preview-icons" id="airfareIconsContainer"> <img id="airfareIconA" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/A.png" alt="A" /> <img id="airfareIconB" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/B.png" alt="B" /> <img id="airfareIconC" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/C.png" alt="C" /> <img id="airfareIconD" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/D.png" alt="D" /> <img id="airfareIconE" src="https://info.tripkicks.com/hubfs/ClientInsights/KeyIcons/mockup/E.png" alt="E" /> <span class="badge d-flex align-items-center px-3" id="airfareBadge" style="background-color: #e7f0ff; color: #1d2d3e; border: 1px solid #427bff; border-radius: 50px; height: 35px;"> On-time arrival 85% </span> </div> <h5 class="fw-bold mt-2" id="airfarePreviewName">NYC to LAX</h5> <p class="text-muted mb-1"> <span id="airfarePreviewAddress">JFK Airport</span> <i class="fa-solid fa-location-dot"></i> <span id="airfarePreviewDistance">2,469 miles</span> </p> </div> <div class="col-md-2 text-end d-flex flex-column justify-content-end"> <p class="mb-1 text-muted small mt-3">From:</p> <h4 class="fw-bold text-dark" id="airfarePreviewPrice">$550</h4> <a href="#" class="btn btn-outline-secondary btn-sm" style="background-color: white; border-color: #ddd; color: #005eb8; padding: 6px 6px; min-width: 80px;"> Book Flight </a> </div> </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/selection/active-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/display/placeholder.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image-more/3.3.0/dom-to-image-more.min.js"></script>

<script>
  // Define handleCapture globally, before any DOMContentLoaded listeners that use it.
  window.handleCapture = async function(elementToCapture, scaleFactor, type = 'png_download', filename = 'capture.png') {
      if (typeof domtoimage === 'undefined') {
          console.error("dom-to-image-more library is not loaded correctly.");
          alert("Image capture library is not available. Please check the browser console for errors related to script loading.");
          return;
      }

      if (!elementToCapture || typeof elementToCapture.offsetWidth === 'undefined') {
          console.error("Invalid element for capture:", elementToCapture);
          alert("Cannot capture: The target element is invalid. Check console.");
          return;
      }

      // Allow browser a moment to render, especially if element was just displayed or changed
      await new Promise(resolve => setTimeout(resolve, 150));

      if (elementToCapture.offsetWidth === 0 || elementToCapture.offsetHeight === 0) {
          const elemId = elementToCapture.id || 'Unnamed element';
          console.error(`Element "${elemId}" has no dimensions (width: ${elementToCapture.offsetWidth}, height: ${elementToCapture.offsetHeight}). Cannot capture.`);
          alert(`Cannot capture: Element "${elemId}" is not visible or has zero dimensions. Please ensure it is displayed correctly.`);
          return;
      }
      
      const transparentPixel = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';

      const options = {
          width: Math.round(elementToCapture.offsetWidth * scaleFactor),
          height: Math.round(elementToCapture.offsetHeight * scaleFactor),
          style: {
              transform: 'scale(' + scaleFactor + ')',
              transformOrigin: 'top left'
          },
          imagePlaceholder: transparentPixel,
          cacheBust: true,
          skipFonts: true, // Added to potentially help with CSS rule access issues
          // bgcolor: '#FFFFFF' // Optional: force a white background if transparency becomes an issue
      };

      console.log(`Attempting to capture ${elementToCapture.id || 'element'} with options:`, JSON.parse(JSON.stringify(options)));


      try {
          let dataUrl; // To hold the result from toPng

          if (type === 'png_download' || type === 'png_blob_copy') {
              dataUrl = await domtoimage.toPng(elementToCapture, options);
          } else {
              throw new Error("Invalid capture type specified");
          }

          if (!dataUrl) {
              throw new Error("domtoimage.toPng returned no data.");
          }

          if (type === 'png_download') {
              const link = document.createElement("a");
              link.download = filename;
              link.href = dataUrl;
              link.click();
          } else if (type === 'png_blob_copy') {
              if (!navigator.clipboard || !window.ClipboardItem) {
                  alert("Copying images to clipboard is not supported by your browser or requires a secure context (HTTPS).");
                  return;
              }
              
              const fetchRes = await fetch(dataUrl); // Convert data URL to blob
              const blob = await fetchRes.blob();

              if (!blob) {
                  alert("Failed to generate image blob for copying.");
                  return;
              }
              const item = new ClipboardItem({ "image/png": blob });
              await navigator.clipboard.write([item]);
              alert(filename.replace(/\.(png|jpg|jpeg)$/i, '') + " copied to clipboard!");
          }
      } catch (error) {
          console.error(`Error during ${type} capture of "${elementToCapture.id || 'element'}":`, error);
          alert(`Failed to capture ${filename.replace(/\.(png|jpg|jpeg)$/i, '')}. Check console for details. Error: ${error.message}`);
      }
  };
</script>

  <script>
  // Banner Logic
  document.addEventListener("DOMContentLoaded", () => {
    const bannerTypeSelector = document.getElementById("bannerType");
    const cityInputs = document.getElementById("cityInputs");
    const bannerContent = document.getElementById("bannerContent");
    const cityNameInput = document.getElementById("cityName");
    const cityImageUrlInput = document.getElementById("cityImageUrl");
    const numTilesInput = document.getElementById("numTiles");
    const generateInputsButton = document.getElementById("generateInputs");
    const renderTilesButton = document.getElementById("renderTiles");
    const button2 = document.getElementById("button2");
    const codeView = document.getElementById("codeView");
    const copyBannerBtn = document.getElementById("copyBannerBtn");
    const downloadBannerBtn = document.getElementById("downloadBannerBtn");
    let tileEditors = [];
    const tileContainer = document.createElement("div");
    tileContainer.id = "tileContainer";
    tileContainer.className = "col-12";
    tileContainer.style.borderRadius = "10px 0 0 10px";
    const nestedRow = document.createElement("div");
    nestedRow.className = "row g-0";
    tileContainer.appendChild(nestedRow);

    if (downloadBannerBtn) {
        downloadBannerBtn.addEventListener('click', () => {
            const banner = document.getElementById("pageBanner");
            if (window.handleCapture) window.handleCapture(banner, 3, 'png_download', 'banner.png');
        });
    } else { console.error("Download Banner Button not found"); }

    if (copyBannerBtn) {
        copyBannerBtn.addEventListener('click', () => {
            const banner = document.getElementById("pageBanner");
            if (window.handleCapture) window.handleCapture(banner, 3, 'png_blob_copy', 'Banner');
        });
         if (!navigator.clipboard || !window.ClipboardItem) {
            copyBannerBtn.disabled = true;
            copyBannerBtn.title = "Copying images to the clipboard is not supported in your browser.";
        }
    } else { console.error("Copy Banner Button not found"); }

    function updateBannerType() { /* ... (Function as before) ... */ }
    function renderTilesMode() { /* ... (Function as before) ... */ }
    function renderTopFullWidthMode() { /* ... (Function as before) ... */ }
    // (Rest of banner generation logic as before)

    // --- Simplified from original, full banner script for brevity here ----
    // Make sure all parts of your original banner script are present in your actual file.
    // For example:
    updateBannerType();
    bannerTypeSelector.addEventListener("change", updateBannerType);
    const templateURLs = { "1tileAuto": "https://info.tripkicks.com/hubfs/mock/auto/1tileAuto.html", /* ... all templates */ "gate4": "https://info.tripkicks.com/hubfs/mock/auto/gate4.html"};
    if (generateInputsButton) { generateInputsButton.addEventListener("click", () => { /* ... complex logic ... */ }); }
    renderTilesButton.addEventListener("click", renderTilesMode);
    if (button2 && !button2.hasAttribute("listener")) { button2.addEventListener("click", renderTopFullWidthMode); button2.setAttribute("listener", "true"); }
    // --- End of simplified section ----
  });
  </script>

  <script>
  // Tile & Modal Section Logic
  document.addEventListener("DOMContentLoaded", function () {
    const toggleBtn = document.getElementById("toggleTileModalBtn");
    const tileModalContent = document.getElementById("tileModalContent");

    if (toggleBtn && tileModalContent) { /* ... (toggle logic as before) ... */ }
    // (CodeMirror setup and template loading as before)

    const previewContainer = document.getElementById("previewContainer");
    const downloadTileModalBtn = document.getElementById("downloadTileModalBtn");
    const copyTileModalPreviewBtn = document.getElementById("copyTileModalPreviewBtn");

    if (downloadTileModalBtn && previewContainer) {
      downloadTileModalBtn.addEventListener("click", () => {
        if (window.handleCapture) window.handleCapture(previewContainer, 4, 'png_download', 'tile-modal-preview.png');
      });
    }
    if (copyTileModalPreviewBtn && previewContainer) {
      copyTileModalPreviewBtn.addEventListener("click", () => {
        if (window.handleCapture) window.handleCapture(previewContainer, 4, 'png_blob_copy', 'Tile-Modal Preview');
      });
      if (!navigator.clipboard || !window.ClipboardItem) { /* ... (disable button) ... */ }
    }
    // (Rest of Tile & Modal JS as before)
  });
  </script>

  <script>
  // Lodging Fare Section Logic
  document.addEventListener("DOMContentLoaded", function () {
    const farePreview = document.getElementById("farePreview");
    const copyFareBtn = document.getElementById("copyFareBtn");
    const downloadFareBtn = document.getElementById("downloadFareBtn");
    // (Other lodging fare variables and functions as before)

    if(copyFareBtn) {
        copyFareBtn.addEventListener("click", () => {
            if (window.handleCapture) window.handleCapture(farePreview, 4, 'png_blob_copy', 'Lodging Fare');
        });
        if (!navigator.clipboard || !window.ClipboardItem) { /* ... (disable button) ... */ }
    }
    if(downloadFareBtn) {
        downloadFareBtn.addEventListener("click", () => {
            if (window.handleCapture) window.handleCapture(farePreview, 4, 'png_download', 'lodging-fare.png');
        });
    }
    // (Rest of Lodging Fare JS as before, including renderFare() call)
  });
  </script>

  <script>
  // Airfare Section Logic
  document.addEventListener("DOMContentLoaded", function () {
    const airfarePreview = document.getElementById("airfarePreview");
    const copyAirfareBtn = document.getElementById("copyAirfareBtn");
    const downloadAirfareBtn = document.getElementById("downloadAirfareBtn");
    // (Other airfare variables and functions as before)

    if(copyAirfareBtn) {
        copyAirfareBtn.addEventListener("click", () => {
            if (window.handleCapture) window.handleCapture(airfarePreview, 4, 'png_blob_copy', 'Airfare');
        });
        if (!navigator.clipboard || !window.ClipboardItem) { /* ... (disable button) ... */ }
    }
    if(downloadAirfareBtn) {
        downloadAirfareBtn.addEventListener("click", () => {
            if (window.handleCapture) window.handleCapture(airfarePreview, 4, 'png_download', 'airfare.png');
        });
    }
    // (Rest of Airfare JS as before, including renderAirfare() call and default value setup)
  });
  </script>

</body>
</html>